---
title: 'Create Session'
openapi: 'POST /session'
description: 'Create a new payment session'
---

## Overview

Creates a new payment session for your customer. The session ID can be used to redirect the customer to the payment page or to fetch available payment methods.

<Note>
  Payment sessions expire after 24 hours if no payment is initiated.
</Note>

## Authentication

This endpoint accepts both **Public API Key** (client-side) and **Secret API Key** (server-side). See [Authentication](/api/authentication) for details.

```bash
Authorization: Bearer YOUR_API_KEY
```

## Integration Modes

<Tabs>
  <Tab title="Client-side (SDK)">
    Use your **Public API Key** when creating sessions from the browser via the JavaScript SDK.
    
    - Client IP is **automatically captured** from the request
    - No need to provide the `ip` parameter
    - Ideal for: websites, single-page applications
    
    ```javascript
    const payviox = new Payviox('pk_live_xxxxxxxxxxxx');
    await payviox.createSession({ ... });
    ```
  </Tab>
  <Tab title="Server-side (API)">
    Use your **Secret API Key** when creating sessions from your backend server.
    
    - You can **optionally provide** the client's IP address via the `ip` parameter
    - If `ip` is provided, it will be validated when the user completes payment
    - If `ip` is not provided, no IP validation will occur
    - Ideal for: backend APIs, mobile app backends, server integrations
    
    ```bash
    curl https://api.payviox.com/session \
      -H "Authorization: Bearer sk_live_xxxxxxxxxxxx" \
      -d '{ "ip": "203.0.113.42", ... }'
    ```
    
    <Warning>
      When you provide an `ip` parameter, the payment page will verify that the user's IP matches. If there's a mismatch, the payment will be rejected with a **403 IP mismatch** error.
    </Warning>
  </Tab>
</Tabs>


## Example Requests

### Client-side Example (Public API Key)

<CodeGroup>

```bash cURL
curl https://api.payviox.com/session \
  -H "Authorization: Bearer pk_live_xxxxxxxxxxxx" \
  -H "Content-Type: application/json" \
  -X POST \
  -d '{
    "amount": 10000,
    "currency": "USD",
    "customer": "customer_abc123",
    "order_id": "order_12345",
    "description": "Premium subscription",
    "items": [
      {
        "name": "Premium Plan",
        "quantity": 1,
        "price": 10000
      }
    ]
  }'
```

```javascript JavaScript
const response = await fetch('https://api.payviox.com/session', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer pk_live_xxxxxxxxxxxx',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    amount: 10000,
    currency: 'USD',
    customer: 'customer_abc123',
    order_id: 'order_12345',
    description: 'Premium subscription',
    items: [
      {
        name: 'Premium Plan',
        quantity: 1,
        price: 10000
      }
    ]
  })
});

const data = await response.json();
console.log(data.session_id);
```

```python Python
import requests

url = 'https://api.payviox.com/session'
headers = {
    'Authorization': 'Bearer pk_live_xxxxxxxxxxxx',
    'Content-Type': 'application/json'
}

payload = {
    'amount': 10000,
    'currency': 'USD',
    'customer': 'customer_abc123',
    'order_id': 'order_12345',
    'description': 'Premium subscription',
    'items': [
        {
            'name': 'Premium Plan',
            'quantity': 1,
            'price': 10000
        }
    ]
}

response = requests.post(url, headers=headers, json=payload)
data = response.json()
print(data['session_id'])
```

```php PHP
<?php

$apiKey = 'pk_live_xxxxxxxxxxxx';
$url = 'https://api.payviox.com/session';

$data = [
    'amount' => 10000,
    'currency' => 'USD',
    'customer' => 'customer_abc123',
    'order_id' => 'order_12345',
    'description' => 'Premium subscription',
    'items' => [
        [
            'name' => 'Premium Plan',
            'quantity' => 1,
            'price' => 10000
        ]
    ]
];

$ch = curl_init($url);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
curl_setopt($ch, CURLOPT_POST, true);
curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($data));
curl_setopt($ch, CURLOPT_HTTPHEADER, [
    'Authorization: Bearer ' . $apiKey,
    'Content-Type: application/json'
]);

$response = curl_exec($ch);
curl_close($ch);

$result = json_decode($response, true);
echo $result['session_id'];
```

```ruby Ruby
require 'net/http'
require 'json'

uri = URI('https://api.payviox.com/session')
http = Net::HTTP.new(uri.host, uri.port)
http.use_ssl = true

request = Net::HTTP::Post.new(uri)
request['Authorization'] = 'Bearer pk_live_xxxxxxxxxxxx'
request['Content-Type'] = 'application/json'

request.body = {
  amount: 10000,
  currency: 'USD',
  customer: 'customer_abc123',
  order_id: 'order_12345',
  description: 'Premium subscription',
  items: [
    {
      name: 'Premium Plan',
      quantity: 1,
      price: 10000
    }
  ]
}.to_json

response = http.request(request)
result = JSON.parse(response.body)
puts result['session_id']
```

```go Go
package main

import (
    "bytes"
    "encoding/json"
    "fmt"
    "net/http"
)

func main() {
    url := "https://api.payviox.com/session"
    
    payload := map[string]interface{}{
        "amount":   10000,
        "currency": "USD",
        "customer": "customer_abc123",
        "order_id":    "order_12345",
        "description": "Premium subscription",
        "items": []map[string]interface{}{
            {
                "name":     "Premium Plan",
                "quantity": 1,
                "price":    10000,
            },
        },
    }
    
    jsonData, _ := json.Marshal(payload)
    
    req, _ := http.NewRequest("POST", url, bytes.NewBuffer(jsonData))
    req.Header.Set("Authorization", "Bearer pk_live_xxxxxxxxxxxx")
    req.Header.Set("Content-Type", "application/json")
    
    client := &http.Client{}
    resp, _ := client.Do(req)
    defer resp.Body.Close()
    
    var result map[string]interface{}
    json.NewDecoder(resp.Body).Decode(&result)
    fmt.Println(result["session_id"])
}
```

</CodeGroup>

### Server-side Example (Secret API Key with IP)

When creating sessions from your backend, you can provide the client's IP address for fraud prevention:

<CodeGroup>

```bash cURL
curl https://api.payviox.com/session \
  -H "Authorization: Bearer sk_live_xxxxxxxxxxxx" \
  -H "Content-Type: application/json" \
  -X POST \
  -d '{
    "amount": 10000,
    "currency": "USD",
    "customer": "customer_abc123",
    "order_id": "order_12345",
    "description": "Premium subscription",
    "ip": "203.0.113.42",
    "items": [
      {
        "name": "Premium Plan",
        "quantity": 1,
        "price": 10000
      }
    ]
  }'
```

```javascript Node.js
// Server-side example (Express.js)
app.post('/create-payment', async (req, res) => {
  const clientIp = req.headers['x-forwarded-for'] || req.ip;
  
  const response = await fetch('https://api.payviox.com/session', {
    method: 'POST',
    headers: {
      'Authorization': 'Bearer sk_live_xxxxxxxxxxxx',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      amount: 10000,
      currency: 'USD',
      customer: req.body.customer,
      order_id: 'order_' + Date.now(),
      description: 'Premium subscription',
      ip: clientIp, // Pass the client's real IP
      items: req.body.items
    })
  });
  
  const data = await response.json();
  res.json({ session_id: data.session_id });
});
```

```python Python (Flask)
from flask import Flask, request, jsonify
import requests

app = Flask(__name__)

@app.route('/create-payment', methods=['POST'])
def create_payment():
    # Get the client's real IP
    client_ip = request.headers.get('X-Forwarded-For', request.remote_addr)
    
    response = requests.post(
        'https://api.payviox.com/session',
        headers={
            'Authorization': 'Bearer sk_live_xxxxxxxxxxxx',
            'Content-Type': 'application/json'
        },
        json={
            'amount': 10000,
            'currency': 'USD',
            'customer': request.json['customer'],
            'order_id': f'order_{int(time.time())}',
            'description': 'Premium subscription',
            'ip': client_ip,  # Pass the client's real IP
            'items': request.json['items']
        }
    )
    
    return jsonify(response.json())
```

```php PHP (Laravel)
<?php

Route::post('/create-payment', function (Request $request) {
    // Get the client's real IP
    $clientIp = $request->header('X-Forwarded-For') ?? $request->ip();
    
    $response = Http::withHeaders([
        'Authorization' => 'Bearer sk_live_xxxxxxxxxxxx',
        'Content-Type' => 'application/json'
    ])->post('https://api.payviox.com/session', [
        'amount' => 10000,
        'currency' => 'USD',
        'customer' => $request->input('customer'),
        'order_id' => 'order_' . time(),
        'description' => 'Premium subscription',
        'ip' => $clientIp, // Pass the client's real IP
        'items' => $request->input('items')
    ]);
    
    return response()->json($response->json());
});
```

</CodeGroup>

<Tip>
  **Without IP parameter:** If you don't provide the `ip` parameter in server-side requests, no IP validation will be performed at payment time. This is useful when you can't reliably determine the client's IP.
</Tip>

## Direct Redirect (Skip Payment Page)

When you specify a `paymentMethodId` for a **redirect-based payment provider** (like Zen, Nicepay, PayPal, etc.), the API will automatically initiate the payment and return a `redirect_url` in the response.

This allows you to **bypass the Payviox payment page** entirely and redirect the customer directly to the payment provider.

<Info>
  This feature is only available for redirect-based providers. For other providers (like Stripe Elements), the standard flow applies.
</Info>

### How it works

1. Create a session with a `paymentMethodId` for a redirect-based provider
2. The API creates the session **and** initiates the payment
3. You receive both `session_id` and `redirect_url` in the response
4. Redirect your customer directly to the `redirect_url`

### Server-side Direct Redirect Example

<CodeGroup>

```javascript Node.js (Express)
app.post('/checkout', async (req, res) => {
  const clientIp = req.headers['x-forwarded-for'] || req.ip;
  
  const response = await fetch('https://api.payviox.com/session', {
    method: 'POST',
    headers: {
      'Authorization': 'Bearer sk_live_xxxxxxxxxxxx',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      amount: 10000,
      currency: 'USD',
      customer: req.body.customer,
      order_id: 'order_' + Date.now(),
      description: 'Premium subscription',
      paymentMethodId: 'zen_card', // Redirect-based provider
      ip: clientIp,
      items: req.body.items
    })
  });
  
  const data = await response.json();
  
  // If redirect_url is present, redirect directly to provider
  if (data.redirect_url) {
    return res.redirect(data.redirect_url);
  }
  
  // Otherwise, redirect to Payviox payment page
  res.redirect(`https://secure.payviox.com/${data.session_id}`);
});
```

```php PHP (Laravel)
Route::post('/checkout', function (Request $request) {
    $clientIp = $request->header('X-Forwarded-For') ?? $request->ip();
    
    $response = Http::withHeaders([
        'Authorization' => 'Bearer sk_live_xxxxxxxxxxxx',
    ])->post('https://api.payviox.com/session', [
        'amount' => 10000,
        'currency' => 'USD',
        'customer' => $request->input('customer'),
        'order_id' => 'order_' . time(),
        'description' => 'Premium subscription',
        'paymentMethodId' => 'zen_card', // Redirect-based provider
        'ip' => $clientIp,
        'items' => $request->input('items')
    ]);
    
    $data = $response->json();
    
    // If redirect_url is present, redirect directly to provider
    if (isset($data['redirect_url'])) {
        return redirect()->away($data['redirect_url']);
    }
    
    // Otherwise, redirect to Payviox payment page
    return redirect()->away('https://secure.payviox.com/' . $data['session_id']);
});
```

```python Python (Flask)
@app.route('/checkout', methods=['POST'])
def checkout():
    client_ip = request.headers.get('X-Forwarded-For', request.remote_addr)
    
    response = requests.post(
        'https://api.payviox.com/session',
        headers={
            'Authorization': 'Bearer sk_live_xxxxxxxxxxxx',
            'Content-Type': 'application/json'
        },
        json={
            'amount': 10000,
            'currency': 'USD',
            'customer': request.json['customer'],
            'order_id': f'order_{int(time.time())}',
            'description': 'Premium subscription',
            'paymentMethodId': 'zen_card',  # Redirect-based provider
            'ip': client_ip,
            'items': request.json['items']
        }
    )
    
    data = response.json()
    
    # If redirect_url is present, redirect directly to provider
    if 'redirect_url' in data:
        return redirect(data['redirect_url'])
    
    # Otherwise, redirect to Payviox payment page
    return redirect(f"https://secure.payviox.com/{data['session_id']}")
```

</CodeGroup>

### Redirect-based Providers

The following providers support direct redirect:

| Provider | Payment Methods |
|----------|----------------|
| Zen | `zen_card`, `zen_blik`, etc. |
| Nicepay | `nicepay_va`, `nicepay_ewallet`, etc. |
| PayPal | `paypal` |
| Payssion | Various local payment methods |
| Pallapay | Crypto payments |
| Crypto.com | `cryptocom` |

<Tip>
  Use the [Get Payment Methods](/api/endpoints/get-payment-methods) endpoint to discover which payment methods are available for your account.
</Tip>

### Handling Payment Errors

If the payment initiation fails (e.g., provider API error), the response will include `payment_error` along with the `session_id`. You can then fall back to the standard flow:

```json
{
  "session_id": "a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6",
  "payment_error": {
    "success": false,
    "message": "Payment creation failed",
    "error_type": "http_error"
  }
}
```

<Warning>
  When `payment_error` is present, the session is still created. You can redirect the customer to `https://secure.payviox.com/{session_id}` to let them try another payment method.
</Warning>

## Example Response

<ResponseExample>

```json Standard Response (201)
{
  "session_id": "a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6"
}
```

```json Direct Redirect Response (201)
{
  "session_id": "a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6",
  "redirect_url": "https://secure.zen.com/checkout/abc123xyz"
}
```

```json Payment Error Response (201)
{
  "session_id": "a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6",
  "payment_error": {
    "success": false,
    "message": "Payment creation failed",
    "error_type": "http_error"
  }
}
```

</ResponseExample>

## Error Responses

<ResponseExample>

```json Missing Required Fields (400)
{
  "amount": [
    "The amount field is required."
  ],
  "currency": [
    "The currency field is required."
  ]
}
```

```json Amount Validation Error (400)
{
  "amount": [
    "The total amount does not match the sum of the items (calculated: 15000, received: 10000)"
  ]
}
```

```json Unauthorized (401)
{
  "error": "Unauthorized"
}
```

```json Invalid Payment Method (400)
{
  "error": "Payment method not found"
}
```

```json IP Mismatch (403) - At payment time
{
  "error": "IP mismatch",
  "message": "Request IP does not match session IP"
}
```

</ResponseExample>

<Note>
  The **IP mismatch** error occurs at payment time (not session creation) when the user's IP doesn't match the `ip` parameter provided during session creation. This is a fraud prevention measure.
</Note>

## Next Steps

After creating a session:

<CardGroup cols={2}>
  <Card
    title="Redirect Customer"
    icon="arrow-up-right-from-square"
    href="/sdk/integration/redirect"
  >
    Redirect the customer to the payment page using the session ID
  </Card>
  <Card
    title="Get Payment Methods"
    icon="credit-card"
    href="/api/endpoints/get-payment-methods"
  >
    Fetch available payment methods for the session
  </Card>
  <Card
    title="Dashboard"
    icon="chart-line"
    href="https://dash.payviox.com"
  >
    Monitor your payments in real-time
  </Card>
  <Card
    title="API Playground"
    icon="flask"
    href="/api/authentication#using-the-api-playground"
  >
    Test API calls directly from your browser
  </Card>
</CardGroup>

## Validation Rules

<AccordionGroup>
  <Accordion title="Amount Validation">
    - Minimum amount: 100 cents ($1.00)
    - Must be a positive integer
    - Total amount must equal the sum of all items (price Ã— quantity)
  </Accordion>

  <Accordion title="Items Validation">
    - At least one item is required
    - Each item must have a name, quantity, and price
    - Quantity must be at least 1
    - Price must be at least 1 cent
  </Accordion>

  <Accordion title="Order ID">
    - Must be unique per business
    - Used for tracking and webhooks
    - Recommended to use your internal order/transaction ID
  </Accordion>
</AccordionGroup>

